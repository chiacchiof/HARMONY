"use strict";(self.webpackChunkdynamic_fault_tree_editor=self.webpackChunkdynamic_fault_tree_editor||[]).push([[699],{699:(e,o,t)=>{t.d(o,{MatlabExecutionService:()=>r});class r{static async executeMatlabSimulation(e){try{console.log("\ud83d\ude80 Sending MATLAB execution request to backend...");const o=await fetch("".concat(this.API_BASE_URL,"/matlab/execute"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error("Backend API error: ".concat(o.status," ").concat(o.statusText));const t=await o.json();if(!t.success)throw new Error(t.error||"MATLAB execution failed");console.log("\u2705 MATLAB execution completed successfully"),console.log("\ud83d\udcca Output:",t.output)}catch(o){throw console.error("\u274c Failed to execute MATLAB:",o),o}}static async startMatlabWithMonitoring(e,o){try{var t;console.log("\ud83d\udd27 Starting MATLAB with real-time monitoring...");const r=new AbortController,a=setTimeout(()=>{console.log("\u23f0 MATLAB execution timeout after 300 seconds"),r.abort()},3e5),n=await fetch("".concat(this.API_BASE_URL,"/matlab/execute-stream"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(e),signal:r.signal});if(!n.ok)throw new Error("Backend API error: ".concat(n.status," ").concat(n.statusText));const s=null===(t=n.body)||void 0===t?void 0:t.getReader();if(!s)throw new Error("Failed to get response stream reader");return new Promise(async(e,t)=>{const r=new TextDecoder;let n="";try{for(;;){const{done:c,value:l}=await s.read();if(c){console.log("\ud83d\udce1 Stream ended"),clearTimeout(a);break}n+=r.decode(l,{stream:!0});const u=n.split("\n");n=u.pop()||"";for(const r of u)if(r.startsWith("data: "))try{const n=r.substring(6);if(n.trim()){const r=JSON.parse(n);if(console.log("\ud83d\udce1 Real-time update:",r),void 0!==r.progress&&o(r.progress,r.output||""),r.success)return console.log("\ud83c\udf89 MATLAB simulation completed!"),clearTimeout(a),s.releaseLock(),void e();if(r.hasOwnProperty("exitCode")&&0!==r.exitCode)return console.error("\u274c MATLAB simulation failed with exit code:",r.exitCode),s.releaseLock(),void t(new Error("MATLAB simulation failed (exit code: ".concat(r.exitCode,")")));if(r.error&&void 0!==r.progress&&(console.error("\u274c MATLAB execution error:",r.error),o(r.progress,"\u274c ERRORE: ".concat(r.error,"\n").concat(r.output||""))),r.error&&void 0===r.progress)return console.error("\u274c MATLAB execution error:",r.error),s.releaseLock(),void t(new Error(r.error))}}catch(i){console.error("Failed to parse SSE data:",i,"Line:",r)}}s.releaseLock(),e()}catch(c){console.error("\u274c Stream reading error:",c),clearTimeout(a),s.releaseLock(),c instanceof Error?"AbortError"===c.name?t(new Error("L'analisi CTMC \xe8 stata interrotta (timeout o cancellazione)")):c.message&&c.message.includes("BodyStreamBuffer")?t(new Error("Errore di connessione durante l'analisi CTMC. Riprova.")):t(c):t(new Error("Errore sconosciuto durante l'analisi CTMC"))}})}catch(r){if(console.error("\u274c Failed to start MATLAB monitoring:",r),r instanceof Error){if("AbortError"===r.name)throw new Error("L'analisi CTMC \xe8 stata interrotta (timeout o cancellazione)");if(r.message.includes("BodyStreamBuffer"))throw new Error("Errore di connessione durante l'analisi CTMC. Verifica che il backend sia attivo e riprova.");if(r.message.includes("fetch"))throw new Error("Impossibile connettersi al backend MATLAB. Verifica che il server sia attivo sulla porta 3001.")}throw r}}static async checkBackendAvailability(){try{return(await fetch("".concat(this.API_BASE_URL,"/health"),{method:"GET",signal:AbortSignal.timeout(1e4)})).ok}catch(e){return console.warn("\u26a0\ufe0f Backend API not available:",e),!1}}static async stopMatlabSimulation(){try{console.log("\ud83d\uded1 Requesting MATLAB simulation stop...");const e=await fetch("".concat(this.API_BASE_URL,"/matlab/stop"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Backend API error: ".concat(e.status," ").concat(e.statusText));const o=await e.json();return o.success?(console.log("\u2705 MATLAB simulation stop requested successfully"),console.log("\ud83d\udcdd Message:",o.message),!0):(console.error("\u274c Failed to stop MATLAB simulation:",o.error),!1)}catch(e){return console.error("\u274c Failed to stop MATLAB simulation:",e),!1}}}r.API_BASE_URL="http://".concat(window.location.hostname,":3001/api")}}]);
//# sourceMappingURL=699.7ff74c08.chunk.js.map